<%= render partial: 'progress_bar', locals: { percent_complete: @percent_complete } %>

<div class="text-center">
  <%= render partial: 'shared/errors', locals: { errored_document: @meter_configuration_document } %>
</div>

<%= form_for @meter_configuration_document, url: wizard_path, :method => :put do |f| %>

  <%= field_set_tag 'UC6 Login Credentials' do %>
    <% @meter_configuration_document.uc6_refresh_token = params[:token] if params[:token].present? %>
    <% unless @meter_configuration_document.uc6_refresh_token.blank? %>
    <div class="form-group">
      <%= f.label :token, class: 'control-label' %>
      <%= f.text_field :uc6_refresh_token, class: 'form-control' %>
    </div>
    <% end %>
    <% unless params[:token].present? %>
    <div class="form-group">
      <%= f.label :email, class: 'control-label' %>
      <%= f.text_field :uc6_login_email, class: 'form-control' %>
    </div>
    <div class="form-group">
      <%= f.label :password, class: 'control-label' %>
      <%= f.password_field :uc6_login_password, class: 'form-control' %>
    </div>
    <% end %>
  <% end %>

  <% if Rails.env.eql?('production') %>
    <% content_for :script do %>
      $(document).ready(function(){
        var results = new RegExp("uc6_api_host=([^&#]*)").exec(window.location.href);
        if ( results ){
          $("#meter_configuration_document_uc6_api_host").val(results[1]);
        } });
    <% end %>
    <%= f.hidden_field :uc6_api_host, value: 'api.6fusion.com' %>
  <% else %>
  <div>
    <a data-toggle="collapse" data-target="#advanced_options" href="#" class="expander collapsed in">Advanced Options</a>
    <%= field_set_tag 'API Configuration', class: 'collapse in', id: 'advanced_options' do %>
    <div class="form-group">
      <%= f.label :host, class: 'control-label' %>
      <%= f.text_field :uc6_api_host, class: 'form-control' %>
    </div>
    <% end %>
  </div>
  <% end %>

  <div class="actions text-right">
    <%= f.submit "Continue", class: 'btn btn-success busy-trigger' %>
  </div>

<% end %>
